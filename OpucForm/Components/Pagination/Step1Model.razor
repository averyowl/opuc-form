<h1>About Lifeline Program</h1>

<div class="application__message">
  <div class="application__message-left">
    <h3 class="mt-3">Oregon Lifeline is a federal and state government program that provides a monthly discount on phone
      <strong>(up to $15.25)</strong> or high-speed internet service <strong>(up to $19.25)</strong> for qualifying
      households with low incomes through participating service providers.
    </h3>

    <h2 class="mt-5">
      <strong>
        You may qualify if you receive one of the following benefits:
      </strong>
    </h2>
    <ul class="application__list">
      <li class="application__item">
        Supplemental Nutrition Assistance Program (SNAP)
      </li>
      <li class="application__item">Medicaid</li>
      <li class="application__item">
        Supplemental Security Income (SSI)
      </li>
      <li class="application__item">Veterans or Survivors Pension</li>
      <li class="application__item">
        Federal Public Housing Assistance (Section 8)
      </li>
      <li class="application__item">
        Total Household Income is at or below 135% of the Federal Poverty
        Guidelines
      </li>

    </ul>

    <h2 class="mt-4"><strong>Tribal Specific Programs:</strong></h2>
    <ul class="application__list">
      <li class="application__item">Tribal General Assistance</li>
      <li class="application__item">Tribal Head Start</li>
      <li class="application__item">
        Tribal Temporary Assistance for Needy Families (TANF)
      </li>
      <li class="application__item">Tribal Food Distribution Program</li>
    </ul>
    <p class="application__text">Oregon residents on <a target="_blank"
        href="https://www.oregon.gov/puc/Documents/Lifeline-Tribal-Lands.pdf">federally-recognized Tribal lands</a> may
      qualify for an additional $25 discount per month.</p>
  </div>
  <div class="application__message-right">

    <div class="application__message-right--i">

      <div class="application__check">
        <h1>Check For Eligibility</h1>
        <div class="application__check-form">
          <label class="application__form-label" for="zipCode">Enter your Zip code to see avaliable providers in your
            area <span class="required">*</span></label>
          <br />
          <p>Enter any Oregon ZIP code ranging between 97000-97999 for testing purposes.</p>
          <input @bind="zipCode" id="EligibilityZip" class="form-control form-control-lg application__input"
            placeholder="Zip Code" type="text" pattern="[0-9]*" maxlength="5" required />
          <button @onclick="CheckZip" name="btnSubmit" value="Check" id="btnSubmit"
            class="btn btn-primary">Check</button>
        </div>
      </div>

      <!-- This  will contain all avaliable providers in the area depending on the zip code. -->
      @if (hasChecked)
      {
        @if (providers.Any())
        {
          <div class="fade-down">
            <div class="application__check-dropdown">
              <ul class="application__check-dropdown--list">
                @foreach (var provider in providers)
                {
                  <li class="application__check-dropdown--item">
                    <a href="javascript:void(0)" class="application__check-dropdown--link"
                      @onclick="() => SelectProvider(provider)">
                      <p class="application__check-dropdown--text">@provider</p>
                      <div class="application__check-dropdown--apply">
                        <p class="application__check-dropdown--subtext">Apply</p>
                        <i class="application__check-dropdown--icon fa-solid fa-angle-right fa-lg"></i>
                      </div>

                    </a>
                  </li>
                }
              </ul>
            </div>

            <h2>
              <strong>The following service providers are in your area:</strong>
            </h2>
          </div>
        }
        else
        {
          <div class="fade-down">
            <p class="text-danger mt-1" style="font-size: 1.5rem; font-weight: 500;">
              <!-- MUST be VALID Oregon Zip code. There are providers in every zip code in Oregon. -->
              @ZipErrorMessage

            </p>
          </div>

        }
        <div class="fade-down">
          <div class="application__check-msg mb-5">
            <p style="color: #565656;" class="application__text"><strong>Note: </strong>Not all service providers are part
              of the Oregon Lifeline program. If your provider does not appear in the list, it may mean they do not
              participate. For a complete list of participating providers, please visit: <a
                href="https://www.oregon.gov/puc/pages/oregon-lifeline.aspx" target="_blank">www.lifeline.oregon.gov</a>
            </p>
            <p style="color: #565656;" class="application__text">The below companies only offer the Oregon Lifeline
              discount
              in select areas. Please call your company to find out if they offer the discount where you live.</p>

            <p class="application__text">
              <strong>AT&T Mobility:</strong>
              <a href="tel:18003779450" class="application__link">
                1-800-377-9450
              </a>
            </p>
            <p class="application__text">
              <strong>Blue Mountain Networks:</strong>
              <a href="tel:5413703000" class="application__link">
                541-370-3000
              </a>
            </p>
            <p class="application__text">
              <strong>Spectrum:</strong>
              <a href="tel:18009417809" class="application__link">
                1-800-941-7809
              </a>
            </p>
            <p class="application__text">
              <strong>Viasat:</strong>
              <a href="tel:18558517419" class="application__link">
                1-855-851-7419
              </a>
            </p>
          </div>
        </div>

      }


      <h4 class="mb-4">Questions? Contact The OPUC:</h4>

      <div class="application__contact">
        <p class="application__text">
          <strong>Phone (Monday - Friday, 9AM - 4PM):</strong>
          <a href="tel:18008484442" class="application__link">
            1-800-848-4442
          </a>
        </p>
        <p class="application__text">
          <strong>Email:</strong>
          <a href="mailto:puc.rspf@puc.oregon.gov" class="application__link">puc.rspf@puc.oregon.gov</a>
        </p>
        <p class="application__text">
          <strong>Fax:</strong>
          <a href="tel:18775671977" class="application__link">
            1-877-567-1977
          </a>
        </p>
      </div>

    </div>

  </div>
</div>

@code {

  /* =========== STEP 1: Check Zip Code =========== */
  [Inject] private IJSRuntime JS { get; set; } = default!;
  [Parameter] public EventCallback<string> OnProviderSelected { get; set; }

  private string zipCode = string.Empty;
  private List<string> providers = new();
  private bool hasChecked = false;
  private string? ZipErrorMessage = null;


  private async Task CheckZip()
  {
    ZipErrorMessage = null;
    hasChecked = true;

    // Ensure input is exactly 5 digits
    if (string.IsNullOrWhiteSpace(zipCode) || zipCode.Length != 5)
    {
      ZipErrorMessage = "Please enter a valid 5-digit ZIP code.";
      providers = new();
      return;
    }

    // Validate Oregon ZIP range
    if (!int.TryParse(zipCode, out int code) || code < 97000 || code > 97999)
    {
      ZipErrorMessage = "Please enter a valid Oregon ZIP code (97000â€“97999).";
      providers = new();
      return;
    }

    // Any Oregon ZIP gets these providers
    providers = new List<string>
{
"Verizon",
"Xfinity"
};

    await JS.InvokeVoidAsync("scrollToElement", ".application__message-right--i", 20);

  }



  private async Task SelectProvider(string provider)
  {
    if (OnProviderSelected.HasDelegate)
      await OnProviderSelected.InvokeAsync(provider);
  }

  /* =========== STEP 1: Check Zip Code =========== */



}